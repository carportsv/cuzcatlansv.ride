<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Drivers - Admin Dashboard</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="drivers.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Config -->
    <script src="../js/config.js"></script>
    <script src="../js/config.override.js"></script>
    <script src="../js/auth.js"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen hidden">
        <div class="loading-spinner"></div>
        <p>Cargando...</p>
    </div>

    <!-- Header de Drivers -->
    <header class="drivers-header" style="background: rgba(0, 0, 0, 0.8); color: white; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
        <div class="header-left">
            <button class="back-btn" onclick="goBack()" style="background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); color: white; padding: 8px 15px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-arrow-left"></i>
                Volver al Home
            </button>
        </div>
        <div class="header-center">
            <h1 style="margin: 0; font-size: 24px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-users" style="color: #4CAF50;"></i> 
                Test Drivers
            </h1>
        </div>
        <div class="header-right">
            <button class="btn btn-primary" onclick="testConnection()" style="background: #4CAF50; border: none; color: white; padding: 8px 15px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-sync-alt"></i>
                Test Connection
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Driver Management Screen -->
        <div id="driverManagementScreen" class="management-screen">
            <!-- Stats Dashboard -->
            <div class="stats-dashboard" style="margin-top: 30px; margin-bottom: 30px;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalDrivers">0</h3>
                            <p>Total Drivers</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="activeDriversCount">0</h3>
                            <p>Active Drivers</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-car"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="availableDrivers">0</h3>
                            <p>Available Drivers</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Test Results -->
            <div id="testResults" style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); border-radius: 12px; padding: 2rem; margin-top: 2rem; color: white;">
                <h3>Test Results</h3>
                <div id="testOutput" style="font-family: monospace; background: rgba(0, 0, 0, 0.3); padding: 1rem; border-radius: 8px; margin-top: 1rem; white-space: pre-wrap;"></div>
            </div>
        </div>
    </main>

    <!-- Estilos adicionales -->
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .admin-main {
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .management-screen {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }
    </style>
    
    <!-- JavaScript Files -->
    <script src="../js/api.js"></script>
    <script src="../js/admin.js"></script>
    
    <!-- Test Functions -->
    <script>
        // Función global para volver al menú principal del admin
        window.goBack = function() {
            console.log('🔙 Volviendo al home del admin...');
            window.location.href = '../home.html';
        };
        
        function goBack() {
            window.goBack();
        }
        
        // Función para probar la conexión
        async function testConnection() {
            const output = document.getElementById('testOutput');
            output.textContent = 'Testing connection...\n';
            
            try {
                // Verificar configuración
                output.textContent += `CONFIG disponible: ${typeof CONFIG !== 'undefined'}\n`;
                if (typeof CONFIG !== 'undefined') {
                    output.textContent += `SUPABASE_URL: ${CONFIG.SUPABASE_URL}\n`;
                    output.textContent += `SUPABASE_ANON_KEY: ${CONFIG.SUPABASE_ANON_KEY ? 'Present' : 'Missing'}\n`;
                }
                
                // Verificar autenticación
                const userData = localStorage.getItem('USER_DATA');
                output.textContent += `USER_DATA en localStorage: ${userData ? 'Present' : 'Missing'}\n`;
                
                if (userData) {
                    const user = JSON.parse(userData);
                    output.textContent += `Usuario: ${user.email}\n`;
                    output.textContent += `Rol: ${user.role}\n`;
                }
                
                // Probar conexión a Supabase
                if (typeof CONFIG !== 'undefined' && CONFIG.SUPABASE_URL && CONFIG.SUPABASE_ANON_KEY) {
                    output.textContent += '\nProbando conexión a Supabase...\n';
                    
                    const response = await fetch(`${CONFIG.SUPABASE_URL}/rest/v1/drivers?select=count`, {
                        headers: {
                            'apikey': CONFIG.SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${CONFIG.SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    output.textContent += `Response status: ${response.status}\n`;
                    output.textContent += `Response ok: ${response.ok}\n`;
                    
                    if (response.ok) {
                        const data = await response.json();
                        output.textContent += `Data: ${JSON.stringify(data, null, 2)}\n`;
                    } else {
                        const errorText = await response.text();
                        output.textContent += `Error: ${errorText}\n`;
                    }
                }
                
            } catch (error) {
                output.textContent += `Error: ${error.message}\n`;
                console.error('Test error:', error);
            }
        }
        
        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚗 Test Drivers page loaded');
            testConnection();
        });
    </script>
</body>
</html>
